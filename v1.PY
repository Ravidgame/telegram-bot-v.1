import os
import re
import telebot
import yt_dlp
import requests
import json
from datetime import datetime

# ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ØµÙ„ÛŒ
TOKEN = "7010739576:AAHi23MSwsrrCw1Jvbdmu0NjXtiStQT-LAU"
DOWNLOAD_FOLDER = "downloads"
MAX_FILE_SIZE = 1500 * 1024 * 1024  # 1500 MB (1.5 GB)
CHANNEL_ID = "@samungofficial"  # ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ú©Ø§Ù†Ø§Ù„ Ø´Ù…Ø§

# Ø§ÛŒØ¬Ø§Ø¯ Ù¾ÙˆØ´Ù‡ Ø¯Ø§Ù†Ù„ÙˆØ¯
if not os.path.exists(DOWNLOAD_FOLDER):
    os.makedirs(DOWNLOAD_FOLDER)

# Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø±Ø¨Ø§Øª
bot = telebot.TeleBot(TOKEN)

def create_keyboard():
    """Ø§ÛŒØ¬Ø§Ø¯ Ú©ÛŒØ¨ÙˆØ±Ø¯ Ø§ÛŒÙ†Ù„Ø§ÛŒÙ† Ø¨Ø±Ø§ÛŒ Ù…Ù†Ùˆ"""
    keyboard = telebot.types.InlineKeyboardMarkup()
    keyboard.row(
        telebot.types.InlineKeyboardButton("ğŸ“¥ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø¯Ø§Ù†Ù„ÙˆØ¯", callback_data="guide"),
        telebot.types.InlineKeyboardButton("â„¹ï¸ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø±Ø¨Ø§Øª", callback_data="about")
    )
    return keyboard

def is_instagram_url(url):
    """Ø¨Ø±Ø±Ø³ÛŒ Ø§Ù†ÙˆØ§Ø¹ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù…"""
    patterns = {
        'post': r'(?:https?:\/\/)?(?:www\.)?instagram\.com\/(?:p|reel|tv)\/([a-zA-Z0-9_-]+)',
        'story': r'(?:https?:\/\/)?(?:www\.)?instagram\.com\/stories\/([a-zA-Z0-9_.-]+)\/([0-9]+)',
        'highlight': r'(?:https?:\/\/)?(?:www\.)?instagram\.com\/stories\/highlights\/([0-9]+)'
    }

    for type_, pattern in patterns.items():
        if re.match(pattern, url):
            return True, type_
    return False, None

def is_youtube_url(url):
    """Ø¨Ø±Ø±Ø³ÛŒ Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ ÛŒÙˆØªÛŒÙˆØ¨"""
    youtube_patterns = [
        r'(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([\w-]{11})',
        r'(?:https?:\/\/)?(?:www\.)?youtube\.com\/shorts\/([\w-]{11})'
    ]

    for pattern in youtube_patterns:
        match = re.match(pattern, url)
        if match:
            return True
    return False

def clean_up_file(file_path):
    """Ø­Ø°Ù ÙØ§ÛŒÙ„"""
    try:
        if os.path.exists(file_path):
            os.remove(file_path)
    except Exception as e:
        print(f"Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù ÙØ§ÛŒÙ„: {e}")

def is_user_in_channel(user_id):
    """Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ú©Ø§Ù†Ø§Ù„"""
    try:
        status = bot.get_chat_member(chat_id=CHANNEL_ID, user_id=user_id).status
        return status in ['member', 'administrator', 'creator']
    except Exception as e:
        print(f"Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª Ú©Ø§Ø±Ø¨Ø±: {e}")
        return False

@bot.message_handler(commands=['start'])
def send_welcome(message):
    """Ù¾ÛŒØ§Ù… Ø®ÙˆØ´â€ŒØ¢Ù…Ø¯Ú¯ÙˆÛŒÛŒ"""
    user_id = message.from_user.id
    if not is_user_in_channel(user_id):
        bot.send_message(
            message.chat.id,
            f"Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø¨Ù‡ Ú©Ø§Ù†Ø§Ù„ Ù…Ø§ Ø¨Ù¾ÛŒÙˆÙ†Ø¯ÛŒØ¯: {CHANNEL_ID}\n\nØ¨Ø¹Ø¯ Ø§Ø² Ø¹Ø¶ÙˆÛŒØªØŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡ /start Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯.",
            reply_markup=create_keyboard()
        )
        return

    welcome_text = """
ğŸŒŸ Ø¨Ù‡ Ø±Ø¨Ø§Øª Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù… Ùˆ ÛŒÙˆØªÛŒÙˆØ¨ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!

Ø§ÛŒÙ† Ø±Ø¨Ø§Øª Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯:
â€¢ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù¾Ø³Øªâ€ŒÙ‡Ø§ÛŒ ÙˆÛŒØ¯ÛŒÙˆÛŒÛŒ Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù… ğŸ¥
â€¢ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø±ÛŒÙ„Ø² ğŸ¬
â€¢ Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙˆÛŒØ¯ÛŒÙˆÙ‡Ø§ÛŒ ÛŒÙˆØªÛŒÙˆØ¨ ğŸ“º
â€¢ Ø¯Ø§Ù†Ù„ÙˆØ¯ IGTV (Ø¨Ø²ÙˆØ¯ÛŒ) ğŸ“±
â€¢ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø§Ø³ØªÙˆØ±ÛŒ (Ø¨Ø²ÙˆØ¯ÛŒ) ğŸ“±

Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ØŒ Ù„ÛŒÙ†Ú© Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯.
    """
    bot.reply_to(message, welcome_text, reply_markup=create_keyboard())

@bot.callback_query_handler(func=lambda call: True)
def handle_query(call):
    """Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ†Ù„Ø§ÛŒÙ†"""
    if call.data == "guide":
        guide_text = """
ğŸ“– Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø¯Ø§Ù†Ù„ÙˆØ¯:

1ï¸âƒ£ ÙˆØ§Ø±Ø¯ Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù… ÛŒØ§ ÛŒÙˆØªÛŒÙˆØ¨ Ø´ÙˆÛŒØ¯
2ï¸âƒ£ Ù¾Ø³Øª Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ø§ Ù¾ÛŒØ¯Ø§ Ú©Ù†ÛŒØ¯
3ï¸âƒ£ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ "..." Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯
4ï¸âƒ£ Ú¯Ø²ÛŒÙ†Ù‡ "Copy Link" Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯
5ï¸âƒ£ Ù„ÛŒÙ†Ú© Ø±Ø§ Ø¯Ø± Ø±Ø¨Ø§Øª paste Ú©Ù†ÛŒØ¯
6ï¸âƒ£ Ù…Ù†ØªØ¸Ø± Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¨Ù…Ø§Ù†ÛŒØ¯

âš ï¸ Ù†Ú©Ø§Øª Ù…Ù‡Ù…:
â€¢ Ø­Ø¯Ø§Ú©Ø«Ø± Ø­Ø¬Ù… ÙØ§ÛŒÙ„: 1.5GB
â€¢ Ø­ØªÙ…Ø§Ù‹ Ø§Ø² Ù„ÛŒÙ†Ú© Ù…Ø¹ØªØ¨Ø± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
â€¢ Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§ØŒ Ú©Ù…ÛŒ ØµØ¨Ø± Ú©Ø±Ø¯Ù‡ Ùˆ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯
        """
        bot.answer_callback_query(call.id)
        bot.edit_message_text(
            guide_text,
            call.message.chat.id,
            call.message.message_id,
            reply_markup=create_keyboard()
        )

    elif call.data == "about":
        about_text = """
â„¹ï¸ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø±Ø¨Ø§Øª:

ğŸ¤– Ù†Ø§Ù…: Ø¯Ø§Ù†Ù„ÙˆØ¯Ø± Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù… Ùˆ ÛŒÙˆØªÛŒÙˆØ¨
ğŸ‘¨â€ğŸ’» Ù†Ø³Ø®Ù‡: 3.0
ğŸ“… Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: {}

Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§:
â€¢ Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙˆÛŒØ¯ÛŒÙˆ Ø¨Ø§ Ø¨Ù‡ØªØ±ÛŒÙ† Ú©ÛŒÙÛŒØª
â€¢ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù… Ùˆ ÛŒÙˆØªÛŒÙˆØ¨
â€¢ Ø³Ø±Ø¹Øª Ø¨Ø§Ù„Ø§ÛŒ Ø¯Ø§Ù†Ù„ÙˆØ¯
â€¢ Ø±Ø§ÛŒÚ¯Ø§Ù† Ùˆ Ø¨Ø¯ÙˆÙ† ØªØ¨Ù„ÛŒØºØ§Øª

ğŸ”œ Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø¢ÛŒÙ†Ø¯Ù‡:
â€¢ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø§Ø³ØªÙˆØ±ÛŒ
â€¢ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù‡Ø§ÛŒÙ„Ø§ÛŒØª
â€¢ Ø¯Ø§Ù†Ù„ÙˆØ¯ IGTV
        """.format(datetime.now().strftime("%Y/%m/%d"))

        bot.answer_callback_query(call.id)
        bot.edit_message_text(
            about_text,
            call.message.chat.id,
            call.message.message_id,
            reply_markup=create_keyboard()
        )

@bot.message_handler(func=lambda message: True)
def handle_messages(message):
    """Ù…Ø¯ÛŒØ±ÛŒØª Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ Ùˆ Ø¯Ø§Ù†Ù„ÙˆØ¯"""
    user_id = message.from_user.id
    if not is_user_in_channel(user_id):
        bot.send_message(
            message.chat.id,
            f"Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ø¨Ù‡ Ú©Ø§Ù†Ø§Ù„ Ù…Ø§ Ø¨Ù¾ÛŒÙˆÙ†Ø¯ÛŒØ¯: {CHANNEL_ID}\n\nØ¨Ø¹Ø¯ Ø§Ø² Ø¹Ø¶ÙˆÛŒØªØŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ù„ÛŒÙ†Ú© Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯.",
            reply_markup=create_keyboard()
        )
        return

    url = message.text.strip()
    is_valid_instagram, content_type = is_instagram_url(url)
    is_valid_youtube = is_youtube_url(url)

    if not (is_valid_instagram or is_valid_youtube):
        bot.reply_to(message, "âŒ Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ù„ÛŒÙ†Ú© Ù…Ø¹ØªØ¨Ø± Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù… ÛŒØ§ ÛŒÙˆØªÛŒÙˆØ¨ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯.")
        return

    status_message = bot.reply_to(message, "â³ Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¯Ø±Ø®ÙˆØ§Ø³Øª...")

    try:
        if is_valid_instagram and content_type in ['post', 'reel']:
            download_media(message, url, status_message)
        elif is_valid_instagram and content_type == 'story':
            bot.edit_message_text(
                "âš ï¸ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø§Ø³ØªÙˆØ±ÛŒ ÙØ¹Ù„Ø§Ù‹ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª. Ø¨Ø²ÙˆØ¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.",
                message.chat.id,
                status_message.message_id
            )
        elif is_valid_instagram and content_type == 'highlight':
            bot.edit_message_text(
                "âš ï¸ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù‡Ø§ÛŒÙ„Ø§ÛŒØª ÙØ¹Ù„Ø§Ù‹ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª. Ø¨Ø²ÙˆØ¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.",
                message.chat.id,
                status_message.message_id
            )
        elif is_valid_youtube:
            download_youtube_video(message, url, status_message)
    except Exception as e:
        bot.edit_message_text(
            f"âŒ Ø®Ø·Ø§ÛŒ ØºÛŒØ±Ù…Ù†ØªØ¸Ø±Ù‡: {str(e)}",
            message.chat.id,
            status_message.message_id
        )

def download_youtube_video(message, url, status_message):
    """Ø¯Ø§Ù†Ù„ÙˆØ¯ Ùˆ Ø§Ø±Ø³Ø§Ù„ ÙˆÛŒØ¯ÛŒÙˆÛŒ ÛŒÙˆØªÛŒÙˆØ¨"""
    try:
        bot.edit_message_text(
            "â³ Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙˆÛŒØ¯ÛŒÙˆÛŒ ÛŒÙˆØªÛŒÙˆØ¨ØŒ Ù„Ø·ÙØ§Ù‹ ØµØ¨Ø± Ú©Ù†ÛŒØ¯...",
            message.chat.id,
            status_message.message_id
        )

        # ØªÙ†Ø¸ÛŒÙ…Ø§Øª yt-dlp Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ù†Ù„ÙˆØ¯ ÛŒÙˆØªÛŒÙˆØ¨
        ydl_opts = {
            'format': 'best[ext=mp4]',  # ÙÙ‚Ø· ÙØ±Ù…Øª mp4 Ø¨Ø§ Ú©ÛŒÙÛŒØª Ø¨Ø§Ù„Ø§
            'outtmpl': os.path.join(DOWNLOAD_FOLDER, 'youtube_%(id)s.%(ext)s'),
            'quiet': True,
            'no_warnings': True,
            'ignoreerrors': False,
            'no_color': True,
            'socket_timeout': 30,
        }

        with yt_dlp.YoutubeDL(ydl_opts) as ydl:
            info = ydl.extract_info(url, download=True)

            # Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯Ù‡
            file_path = ydl.prepare_filename(info)

            # Ø§Ú¯Ø± Ø³Ø§ÛŒØ² ÙØ§ÛŒÙ„ Ø¨ÛŒØ´ Ø§Ø² Ø­Ø¯ Ù…Ø¬Ø§Ø² Ø¨Ø§Ø´Ø¯
            if os.path.getsize(file_path) > MAX_FILE_SIZE:
                bot.edit_message_text(
                    "âš ï¸ Ø­Ø¬Ù… ÙØ§ÛŒÙ„ Ø¨ÛŒØ´ØªØ± Ø§Ø² Ø­Ø¯ Ù…Ø¬Ø§Ø² Ø§Ø³Øª (1.5 Ú¯ÛŒÚ¯Ø§Ø¨Ø§ÛŒØª)",
                    message.chat.id,
                    status_message.message_id
                )
                clean_up_file(file_path)
                return

            # Ø§Ø±Ø³Ø§Ù„ ÙˆÛŒØ¯ÛŒÙˆ
            with open(file_path, 'rb') as media_file:
                bot.send_video(
                    message.chat.id,
                    media_file,
                    caption=f"ğŸ¥ {info.get('title', 'ÙˆÛŒØ¯ÛŒÙˆÛŒ ÛŒÙˆØªÛŒÙˆØ¨')}\n\n Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ø±Ø¨Ø§Øª",
                    reply_to_message_id=message.message_id
                )

        bot.edit_message_text(
            "âœ… ÙØ§ÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯!",
            message.chat.id,
            status_message.message_id
        )

        # Ø­Ø°Ù ÙØ§ÛŒÙ„ Ø¨Ø¹Ø¯ Ø§Ø² Ø§Ø±Ø³Ø§Ù„
        clean_up_file(file_path)

    except Exception as e:
        bot.edit_message_text(
            f"âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙˆÛŒØ¯ÛŒÙˆÛŒ ÛŒÙˆØªÛŒÙˆØ¨: {str(e)}",
            message.chat.id,
            status_message.message_id
        )
        print(f"Ø®Ø·Ø§ÛŒ Ø¯Ù‚ÛŒÙ‚ Ø¯Ø§Ù†Ù„ÙˆØ¯: {e}")

def download_media(message, url, status_message):
    """Ø¯Ø§Ù†Ù„ÙˆØ¯ Ùˆ Ø§Ø±Ø³Ø§Ù„ Ù…Ø¯ÛŒØ§"""
    try:
        bot.edit_message_text(
            "â³ Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯ØŒ Ù„Ø·ÙØ§Ù‹ ØµØ¨Ø± Ú©Ù†ÛŒØ¯...",
            message.chat.id,
            status_message.message_id
        )

        ydl_opts = {
            'outtmpl': os.path.join(DOWNLOAD_FOLDER, '%(id)s.%(ext)s'),
            'format': 'best',
            'quiet': True,
        }

        with yt_dlp.YoutubeDL(ydl_opts) as ydl:
            info = ydl.extract_info(url, download=True)
            file_path = os.path.join(DOWNLOAD_FOLDER, f"{info['id']}.{info['ext']}")

            if os.path.getsize(file_path) > MAX_FILE_SIZE:
                bot.edit_message_text(
                    "âš ï¸ Ø­Ø¬Ù… ÙØ§ÛŒÙ„ Ø¨ÛŒØ´ØªØ± Ø§Ø² Ø­Ø¯ Ù…Ø¬Ø§Ø² Ø§Ø³Øª (1.5 Ú¯ÛŒÚ¯Ø§Ø¨Ø§ÛŒØª)",
                    message.chat.id,
                    status_message.message_id
                )
                clean_up_file(file_path)
                return

            with open(file_path, 'rb') as media_file:
                if info['ext'] in ['mp4', 'mov']:
                    bot.send_video(
                        message.chat.id,
                        media_file,
                        caption="ğŸ¥  @instagramddownload_botØ¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ø±Ø¨Ø§Øª",
                        reply_to_message_id=message.message_id
                    )
                else:
                    bot.send_document(
                        message.chat.id,
                        media_file,
                        caption="ğŸ“ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ø±Ø¨Ø§Øª",
                        reply_to_message_id=message.message_id
                    )

            bot.edit_message_text(
                "âœ… ÙØ§ÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯!",
                message.chat.id,
                status_message.message_id
            )

    except yt_dlp.utils.DownloadError:
        bot.edit_message_text(
            "âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø§Ù†Ù„ÙˆØ¯. Ù„Ø·ÙØ§Ù‹ Ù„ÛŒÙ†Ú© Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø¨Ø¹Ø¯Ø§Ù‹ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.",
            message.chat.id,
            status_message.message_id
        )
    except Exception as e:
        bot.edit_message_text(
            f"âŒ Ø®Ø·Ø§ÛŒ ØºÛŒØ±Ù…Ù†ØªØ¸Ø±Ù‡: {str(e)}",
            message.chat.id,
            status_message.message_id
        )
    finally:
        if 'file_path' in locals():
            clean_up_file(file_path)

def main():
    """ØªØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ"""
    print("ğŸ¤– Ø±Ø¨Ø§Øª Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§Ø³Øª...")
    try:
        bot.infinity_polling()
    except Exception as e:
        print(f"Ø®Ø·Ø§ Ø¯Ø± Ø§Ø¬Ø±Ø§ÛŒ Ø±Ø¨Ø§Øª: {e}")

if __name__ == "__main__":
    main()
